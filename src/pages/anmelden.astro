---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
---

<BaseLayout title="Anmelden ‚Äì Novamarkt">
    <Header />
    <main class="auth-main">
        <div class="auth-container">
            <!-- Left: Form -->
            <div class="auth-form-side">
                <div class="auth-inner">
                    <div class="auth-logo">
                        <div class="logo-icon-sm">
                            <svg
                                width="18"
                                height="18"
                                viewBox="0 0 24 24"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <path
                                    d="M12 2L2 7v10l10 5 10-5V7L12 2z"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    stroke-linejoin="round"
                                    fill="rgba(6,182,212,0.15)"></path>
                                <path
                                    d="M12 22V12M2 7l10 5 10-5"
                                    stroke="currentColor"
                                    stroke-width="2"></path>
                            </svg>
                        </div>
                        Secure<span style="color:var(--color-primary);"
                            >Markt</span
                        >
                    </div>

                    <!-- Tab Switch -->
                    <div class="auth-tabs">
                        <button class="auth-tab active" id="loginTab"
                            >Anmelden</button
                        >
                        <button class="auth-tab" id="registerTab"
                            >Registrieren</button
                        >
                    </div>

                    <!-- Login Form -->
                    <form class="auth-form" id="loginForm">
                        <div class="form-group">
                            <label class="label" for="loginEmail"
                                >E-Mail-Adresse</label
                            >
                            <div class="input-icon-wrap">
                                <svg
                                    width="16"
                                    height="16"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    ><path
                                        d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
                                    ></path><polyline points="22,6 12,13 2,6"
                                    ></polyline></svg
                                >
                                <input
                                    type="email"
                                    id="loginEmail"
                                    class="input input-with-icon"
                                    placeholder="name@beispiel.de"
                                />
                            </div>
                        </div>
                        <div class="form-group">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:var(--space-2);"
                            >
                                <label
                                    class="label"
                                    for="loginPw"
                                    style="margin:0;">Passwort</label
                                >
                                <a
                                    href="/passwort-vergessen"
                                    style="font-size:var(--text-xs); color:var(--color-primary);"
                                    >Vergessen?</a
                                >
                            </div>
                            <div class="input-icon-wrap">
                                <svg
                                    width="16"
                                    height="16"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    ><rect
                                        x="3"
                                        y="11"
                                        width="18"
                                        height="11"
                                        rx="2"
                                        ry="2"></rect><path
                                        d="M7 11V7a5 5 0 0 1 10 0v4"
                                    ></path></svg
                                >
                                <input
                                    type="password"
                                    id="loginPw"
                                    class="input input-with-icon"
                                    placeholder="Dein Passwort"
                                />
                                <button
                                    type="button"
                                    class="pw-toggle"
                                    id="togglePw"
                                >
                                    <svg
                                        width="14"
                                        height="14"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2"
                                        ><path
                                            d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"
                                        ></path><circle cx="12" cy="12" r="3"
                                        ></circle></svg
                                    >
                                </button>
                            </div>
                        </div>

                        <!-- 2FA Info -->
                        <div class="twofa-info">
                            <svg
                                width="14"
                                height="14"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                ><path
                                    d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"
                                ></path></svg
                            >
                            2-Faktor-Authentifizierung sch√ºtzt deinen Account
                        </div>

                        <button
                            type="submit"
                            class="btn btn-primary w-full btn-lg"
                            >Anmelden</button
                        >

                        <div class="or-divider"><span>oder</span></div>

                        <button type="button" class="btn btn-secondary w-full">
                            <svg width="18" height="18" viewBox="0 0 24 24"
                                ><path
                                    fill="#4285F4"
                                    d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                                ></path><path
                                    fill="#34A853"
                                    d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                                ></path><path
                                    fill="#FBBC05"
                                    d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                                ></path><path
                                    fill="#EA4335"
                                    d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                                ></path></svg
                            >
                            Mit Google anmelden
                        </button>
                    </form>

                    <!-- Register Form -->
                    <form class="auth-form hidden" id="registerForm">
                        <div class="form-row">
                            <div class="form-group" style="flex:1;">
                                <label class="label" for="firstName"
                                    >Vorname</label
                                >
                                <input
                                    type="text"
                                    id="firstName"
                                    class="input"
                                    placeholder="Max"
                                />
                            </div>
                            <div class="form-group" style="flex:1;">
                                <label class="label" for="lastName"
                                    >Nachname</label
                                >
                                <input
                                    type="text"
                                    id="lastName"
                                    class="input"
                                    placeholder="Mustermann"
                                />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="label" for="regEmail"
                                >E-Mail-Adresse</label
                            >
                            <input
                                type="email"
                                id="regEmail"
                                class="input"
                                placeholder="name@beispiel.de"
                            />
                        </div>
                        <div class="form-group">
                            <label class="label" for="phone"
                                >Handynummer (f√ºr 2FA)</label
                            >
                            <div class="phone-wrap">
                                <select class="input phone-prefix">
                                    <option>+49</option>
                                    <option>+43</option>
                                    <option>+41</option>
                                </select>
                                <input
                                    type="tel"
                                    id="phone"
                                    class="input"
                                    placeholder="0151 123 456 78"
                                />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="label" for="regPw">Passwort</label>
                            <input
                                type="password"
                                id="regPw"
                                class="input"
                                placeholder="Mindestens 8 Zeichen"
                            />
                            <div class="pw-strength-wrap">
                                <div class="pw-strength-bar" id="pwStrengthBar">
                                </div>
                            </div>
                            <div class="pw-strength-label" id="pwStrengthLabel">
                            </div>
                        </div>

                        <!-- KYC Info box -->
                        <div class="kyc-info-box">
                            <div class="kyc-info-header">
                                <svg
                                    width="16"
                                    height="16"
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    ><path
                                        d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"
                                    ></path><circle cx="12" cy="7" r="4"
                                    ></circle></svg
                                >
                                Identit√§tspr√ºfung (KYC)
                            </div>
                            <p>
                                Nach der Registrierung wirst du gebeten, deine
                                Identit√§t mit einem Ausweisdokument zu
                                verifizieren. Dies sch√ºtzt alle Nutzer vor
                                Betrug.
                            </p>
                            <div class="kyc-steps">
                                <div class="kyc-step">üìß E-Mail best√§tigen</div>
                                <div class="kyc-arrow">‚Üí</div>
                                <div class="kyc-step">
                                    üì± Handy verifizieren
                                </div>
                                <div class="kyc-arrow">‚Üí</div>
                                <div class="kyc-step">ü™™ Ausweis hochladen</div>
                            </div>
                        </div>

                        <label
                            class="checklist-item"
                            style="margin-bottom:var(--space-4);"
                        >
                            <input
                                type="checkbox"
                                id="regAgb"
                                style="width:18px;height:18px;accent-color:var(--color-primary);"
                            />
                            <span
                                style="font-size:var(--text-sm); color:var(--color-text-muted);"
                                >Ich akzeptiere die <a
                                    href="/agb"
                                    style="color:var(--color-primary);">AGB</a
                                > und die <a
                                    href="/datenschutz"
                                    style="color:var(--color-primary);"
                                    >Datenschutzerkl√§rung</a
                                ></span
                            >
                        </label>

                        <button
                            type="submit"
                            class="btn btn-primary w-full btn-lg"
                            >Kostenlos registrieren</button
                        >
                    </form>
                </div>
            </div>

            <!-- Right: Benefits -->
            <div class="auth-benefits-side">
                <div class="auth-benefits-inner">
                    <h2 class="benefits-title">Warum Novamarkt?</h2>
                    <div class="benefits-list">
                        <div class="benefit-item">
                            <div class="benefit-icon">üõ°Ô∏è</div>
                            <div>
                                <strong>Kein Betrug m√∂glich</strong>
                                <p>
                                    KYC-Verifizierung & Treuhandkonto machen
                                    Betrug nahezu unm√∂glich.
                                </p>
                            </div>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">‚≠ê</div>
                            <div>
                                <strong>Bewertungssystem</strong>
                                <p>
                                    Transparente Bewertungen schaffen Vertrauen
                                    zwischen K√§ufern und Verk√§ufern.
                                </p>
                            </div>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">üí¨</div>
                            <div>
                                <strong>Sicherer Chat</strong>
                                <p>
                                    Nachrichten werden auf Betrugsmuster
                                    analysiert ‚Äì mit automatischen Warnungen.
                                </p>
                            </div>
                        </div>
                        <div class="benefit-item">
                            <div class="benefit-icon">üÜì</div>
                            <div>
                                <strong>Kostenlos inserieren</strong>
                                <p>
                                    Anzeigen sind kostenlos. Nur der optionale
                                    Treuhand-Service ist kostenpflichtig.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="auth-stat">
                            <span class="stat-num">250k+</span>
                            <span class="stat-label">Verifizierte Nutzer</span>
                        </div>
                        <div class="auth-stat">
                            <span class="stat-num">98,3%</span>
                            <span class="stat-label">Sichere Deals</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <Footer />
</BaseLayout>

<style>
    .auth-main {
        min-height: calc(100vh - 70px);
        display: flex;
        align-items: center;
    }
    .auth-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        min-height: calc(100vh - 70px);
        width: 100%;
    }
    .auth-form-side {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-10) var(--space-8);
    }
    .auth-inner {
        width: 100%;
        max-width: 420px;
    }
    .auth-logo {
        font-size: var(--text-xl);
        font-weight: 800;
        display: flex;
        align-items: center;
        gap: var(--space-2);
        margin-bottom: var(--space-8);
    }
    .logo-icon-sm {
        width: 32px;
        height: 32px;
        background: linear-gradient(
            135deg,
            var(--color-primary),
            var(--color-accent)
        );
        border-radius: var(--radius);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
    }
    .auth-tabs {
        display: flex;
        background: var(--color-surface-2);
        border-radius: var(--radius-lg);
        padding: 4px;
        margin-bottom: var(--space-8);
    }
    .auth-tab {
        flex: 1;
        padding: 0.65rem;
        border-radius: var(--radius);
        font-size: var(--text-sm);
        font-weight: 600;
        color: var(--color-text-muted);
        cursor: pointer;
        transition: all var(--transition);
    }
    .auth-tab.active {
        background: var(--color-surface);
        color: var(--color-text);
        box-shadow: var(--shadow-sm);
    }
    .auth-form {
        display: flex;
        flex-direction: column;
        gap: var(--space-1);
    }
    .input-icon-wrap {
        position: relative;
        display: flex;
        align-items: center;
    }
    .input-icon-wrap > svg {
        position: absolute;
        left: 1rem;
        color: var(--color-text-faint);
        pointer-events: none;
    }
    .input-with-icon {
        padding-left: 2.75rem !important;
    }
    .pw-toggle {
        position: absolute;
        right: 0.75rem;
        background: none;
        border: none;
        color: var(--color-text-faint);
        cursor: pointer;
        padding: 0.25rem;
    }
    .pw-toggle:hover {
        color: var(--color-text);
    }
    .twofa-info {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        font-size: var(--text-xs);
        color: var(--color-success);
        background: rgba(16, 185, 129, 0.06);
        border: 1px solid rgba(16, 185, 129, 0.2);
        padding: var(--space-2) var(--space-3);
        border-radius: var(--radius);
        margin-bottom: var(--space-4);
    }
    .or-divider {
        display: flex;
        align-items: center;
        gap: var(--space-3);
        margin: var(--space-4) 0;
        color: var(--color-text-faint);
        font-size: var(--text-xs);
    }
    .or-divider::before,
    .or-divider::after {
        content: "";
        flex: 1;
        height: 1px;
        background: var(--color-border);
    }
    .phone-wrap {
        display: flex;
        gap: var(--space-2);
    }
    .phone-prefix {
        width: 80px;
        flex-shrink: 0;
    }
    .pw-strength-wrap {
        height: 4px;
        background: var(--color-surface-2);
        border-radius: var(--radius-full);
        margin-top: var(--space-2);
        overflow: hidden;
    }
    .pw-strength-bar {
        height: 100%;
        border-radius: var(--radius-full);
        transition: all 0.3s ease;
        width: 0;
    }
    .pw-strength-label {
        font-size: var(--text-xs);
        margin-top: 4px;
    }
    .kyc-info-box {
        background: rgba(59, 130, 246, 0.05);
        border: 1px solid rgba(59, 130, 246, 0.2);
        border-radius: var(--radius-lg);
        padding: var(--space-4);
        margin: var(--space-2) 0 var(--space-4);
    }
    .kyc-info-header {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        color: var(--color-accent);
        font-size: var(--text-sm);
        font-weight: 700;
        margin-bottom: var(--space-2);
    }
    .kyc-info-box p {
        font-size: var(--text-xs);
        color: var(--color-text-muted);
        margin-bottom: var(--space-3);
        line-height: 1.6;
    }
    .kyc-steps {
        display: flex;
        align-items: center;
        gap: var(--space-2);
        flex-wrap: wrap;
    }
    .kyc-step {
        font-size: var(--text-xs);
        font-weight: 600;
        background: var(--color-surface-3);
        padding: 0.3rem 0.65rem;
        border-radius: var(--radius-full);
    }
    .kyc-arrow {
        color: var(--color-text-faint);
        font-size: var(--text-xs);
    }
    .checklist-item {
        display: flex;
        align-items: flex-start;
        gap: var(--space-3);
        cursor: pointer;
    }
    .hidden {
        display: none !important;
    }
    .form-row {
        display: flex;
        gap: var(--space-3);
    }

    /* Benefits Side */
    .auth-benefits-side {
        background: linear-gradient(
            135deg,
            var(--color-surface) 0%,
            #0d1929 100%
        );
        border-left: 1px solid var(--color-border);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: var(--space-10);
        position: relative;
        overflow: hidden;
    }
    .auth-benefits-side::before {
        content: "";
        position: absolute;
        top: -50%;
        right: -30%;
        width: 600px;
        height: 600px;
        background: radial-gradient(
            circle,
            rgba(6, 182, 212, 0.05) 0%,
            transparent 70%
        );
    }
    .auth-benefits-inner {
        width: 100%;
        max-width: 380px;
        position: relative;
    }
    .benefits-title {
        font-size: var(--text-2xl);
        font-weight: 800;
        letter-spacing: -0.03em;
        margin-bottom: var(--space-8);
    }
    .benefits-list {
        display: flex;
        flex-direction: column;
        gap: var(--space-6);
        margin-bottom: var(--space-10);
    }
    .benefit-item {
        display: flex;
        gap: var(--space-4);
        align-items: flex-start;
    }
    .benefit-icon {
        font-size: 1.5rem;
        flex-shrink: 0;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--color-surface-2);
        border-radius: var(--radius-lg);
    }
    .benefit-item strong {
        display: block;
        font-weight: 700;
        margin-bottom: 4px;
    }
    .benefit-item p {
        font-size: var(--text-sm);
        color: var(--color-text-muted);
        line-height: 1.6;
    }
    .stat-row {
        display: flex;
        gap: var(--space-6);
        padding: var(--space-5);
        background: var(--color-surface-2);
        border-radius: var(--radius-xl);
        border: 1px solid var(--color-border);
    }
    .auth-stat {
        display: flex;
        flex-direction: column;
    }
    .stat-num {
        font-size: var(--text-2xl);
        font-weight: 800;
        letter-spacing: -0.03em;
        color: var(--color-primary);
    }

    @media (max-width: 900px) {
        .auth-container {
            grid-template-columns: 1fr;
        }
        .auth-benefits-side {
            display: none;
        }
        .auth-main {
            align-items: flex-start;
        }
    }
</style>

<script>
    // Tab switching
    const loginTab = document.getElementById("loginTab")!;
    const registerTab = document.getElementById("registerTab")!;
    const loginForm = document.getElementById("loginForm")!;
    const registerForm = document.getElementById("registerForm")!;

    loginTab.addEventListener("click", () => {
        loginTab.classList.add("active");
        registerTab.classList.remove("active");
        loginForm.classList.remove("hidden");
        registerForm.classList.add("hidden");
    });
    registerTab.addEventListener("click", () => {
        registerTab.classList.add("active");
        loginTab.classList.remove("active");
        registerForm.classList.remove("hidden");
        loginForm.classList.add("hidden");
    });

    // Password toggle
    document.getElementById("togglePw")?.addEventListener("click", () => {
        const pw = document.getElementById("loginPw") as HTMLInputElement;
        pw.type = pw.type === "password" ? "text" : "password";
    });

    // Password strength meter
    document.getElementById("regPw")?.addEventListener("input", (e) => {
        const val = (e.target as HTMLInputElement).value;
        const bar = document.getElementById("pwStrengthBar")!;
        const label = document.getElementById("pwStrengthLabel")!;
        let strength = 0;
        if (val.length >= 8) strength++;
        if (/[A-Z]/.test(val)) strength++;
        if (/[0-9]/.test(val)) strength++;
        if (/[^A-Za-z0-9]/.test(val)) strength++;

        const levels = [
            { color: "#ef4444", text: "Schwach", width: "25%" },
            { color: "#f59e0b", text: "Mittel", width: "50%" },
            { color: "#06b6d4", text: "Gut", width: "75%" },
            { color: "#10b981", text: "Sehr sicher", width: "100%" },
        ];
        if (val.length === 0) {
            bar.style.width = "0";
            label.textContent = "";
            return;
        }
        const lvl = levels[Math.min(strength - 1, 3)];
        bar.style.background = lvl.color;
        bar.style.width = lvl.width;
        label.style.color = lvl.color;
        label.textContent = lvl.text;
    });
</script>
